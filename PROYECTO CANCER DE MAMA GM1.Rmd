---
title: |
  ![](Logo_UCO.png){width=10%}
  <span style="color:#4682B4; text-align:center; display:block;">METABRIC: Análisis de Cáncer de Mama</span>
  ![](Logo_FacCiencias.png){width=10%}
author: "Andrea Zurita, Leo Alza, Lucia Güeto y Paula Cubero"
data: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: flatly
bibliography: ["referencias.bib", "libraries.bib"]
link-citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

<!-- DESCARGAMOS LIBRERIAS EN CONSOLA -->

```{r instalar-paquetes, eval=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
install.packages(c(
  "dplyr",
  "ggplot2",
  "readr",
  "readxl",
  "knitr"
  ))
```
<!-- CARGAMOS LIBRERIAS -->
```{r cargar-librerias, echo=FALSE, warning=FALSE, message=FALSE}
library("dplyr")
library("ggplot2")
library("knitr")

```



```{r leer-datos, echo=FALSE}

mis_datos <- read.csv ("METABRIC_RNA_Mutation.csv")
mis_datos_ruta_local <-"C:/Users/leoal/OneDrive/Escritorio/PROYECTO CANCER DE MAMA/METABRIC_RNA_Mutation.csv"

```

```{r crear-bib-paquetes, eval=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
knitr::write_bib(
  c("dplyr","ggplot2","knitr"),
  "libraries.bib"
)
```

# Introducción


El cáncer es una de las principales causas de mortalidad a nivel mundial y representa un **problema sanitario, social y científico de primer orden**. Dentro de este grupo de enfermedades, el <span style="color:#c0392b;"><b>cáncer de mama</b></span> constituye con diferencia el tipo de cáncer más frecuente en mujeres, mientras que otros tumores como los <span style="color:#2980b9;"><b>sarcomas</b></span> representan una fracción muy reducida de los casos diagnosticados.

En este trabajo se emplea el dataset **Breast Cancer Gene Expression Profiles (METABRIC)**, disponible públicamente en Kaggle, que recoge información clínica y molecular de miles de pacientes con cáncer de mama. Este conjunto de datos permite estudiar de forma integrada variables demográficas, clínicas y de supervivencia, ofreciendo una base sólida para el análisis de factores pronósticos.

Entre las variables analizadas destacan:


- <b><span style="color:#16a085;">age_at_diagnosis</span></b>: edad del paciente en el momento del diagnóstico.

- <b><span style="color:#16a085;">overall_survival_months</span></b>: meses de supervivencia general. Duración desde el momento de la intervención hasta el fallecimiento.

- <b><span style="color:#16a085;">tumor_size</span></b>: tamaño del tumor medido mediante técnicas de imagen.

- <b><span style="color:#16a085;">chemotherapy</span></b>: Si el paciente recibió o no quimioterapia.

---

## Planteamiento de hipótesis

### Hipotesis 1: Edad y cirugía realizada al paciente

Se comparará la **edad de diagnóstico**  de los pacientes que se sometieron a una **mastectomía** frente a aquellos que no tuvieron que realizársela y **conservaron el pecho**. 
El objetivo es evaluar si existe una relación entre la **edad del diagnóstico del paciente** y el **tipo de cirugía**. 

- **Hipótesis nula(H₀):** Las edades medias de las mujeres que se hicieron mastectomía y de las que conservaron el pecho son iguales.
- **Hipótesis alternativa (H₁):**  Las edades medias de las mujeres que se hicieron mastectomía y de las que conservaron el pecho son diferentes.

### Hipotesis 2: Tamaño de tumor y tipo de cirugía

Se comparará el **tamaño del tumor** con el **tipo de cirugía** realizada para ver si el tamaño de este determina la decisión de hacer una mastectomía o no, o es otro parámetro el determinante del tipo de cirugía que se realiza.

- **Hipótesis nula(H₀):** El tamaño medio del tumor de las mujeres con mastectomía es igual al tamaño medio de las que conservaron el pecho.

- **Hipótesis alternativa (H₁):** El tamaño medio del tumor de las mujeres con mastectomía es mayor al tamaño medio de las que conservaron el pecho.

### Hipótesis 3: Quimioterapia y meses de supervivencia 

Se comparará los meses de supervivencia de las mujeres en función de si se han sometido o no a quimioterapia.

- **Hipótesis nula(H₀):** Los meses de supervivencia no están relacionados significativamente con la administración de quimioterapia.
- **Hipótesis alternativa (H₁):** Los meses de supervivencia están relacionados significativamente con la administración de quimioterapia.


En conjunto, este estudio pretende **evaluar la validez de estas hipótesis utilizando datos reales**, aplicando métodos estadísticos descriptivos, inferenciales y análisis de supervivencia, con el objetivo de comprender mejor los factores clínicos que influyen en el pronóstico del cáncer de mama.

<!-- Primera vista de los datos -->

```{r vista-datos, echo=FALSE}
knitr::kable(head(mis_datos, 10), align = 'c', caption = "Tabla 1: Vista preliminar de las 10 primeras lineas del dataset METABRIC")
```
<!-- El código R en línea -->

Los datos tienen `r nrow(mis_datos)` filas y `r ncol(mis_datos)` columnas.



# Materiales y Métodos

Para realizar los análisis se han usado R [@R-base] con las librerias dplyr [@R-dplyr] y ggplot [@R-ggplot2; @ggplot22016]. Para la creación de este informe hemos utilizado el paquete knitr [@R-knitr; @knitr2015; @knitr2014] y pandoc.


# Análisis y Resultados

## Análisis de edad de diagnóstico vs tipo de cirugía

Se seleccionan las columnas 2 y 3 que se corresponden con la edad de diagnóstico y tipo de cirugía. Con el código filter hemos eliminado aquellas celdas en donde no se resgistraton datos tanto de edades de diagnóstico como de tipo de cirugía. 

```{r seleccion_de_columnas_1, echo=TRUE}
datos_filtrados_1 <- mis_datos %>%   # Creamos un nuevo objeto llamado "datos_filtrados_1" a partir del dataset "mis_datos" y usamos pipe para encadenar las operaciones 

  filter(!is.na(type_of_breast_surgery),
         type_of_breast_surgery != "")%>%  # Filtramos aquellas filas donde la columna "type_of_breast_surgery" no sea NA (un valor que no existe) y que no esté vacío.
  select(2, 3) # Seleccionamos solo las columnas 2 y 3 del dataset

```

```{r tabla estadistica descriptivas edad y cirugia, echo=FALSE}
Resumen_Tabla_1 <- datos_filtrados_1 %>%
  summarise(n = length(age_at_diagnosis),
    Media = mean(age_at_diagnosis, na.rm = TRUE),
    Mediana = median(age_at_diagnosis, na.rm = TRUE),
    SD = sd(age_at_diagnosis, na.rm = TRUE),
    Mínimo = min(age_at_diagnosis, na.rm = TRUE),
    Máximo= max(age_at_diagnosis, na.rm = TRUE)) 
kable(Resumen_Tabla_1, 
      caption = "Tabla 1. Estadísticas descriptivas de la edad al diagnóstico ")
print(Resumen_Tabla_1)
```

### Gráficos de resultados de edad de diagnóstico y tipo de cirugía


````{r grafico edad de diagnóstico y tipo de cirugia,fig.cap = "Figura 1. Boxplot de la edad de diagnóstico según el tipo de cirugía", echo=TRUE}
ggplot(datos_filtrados_1,
       aes(x = type_of_breast_surgery,
           y = age_at_diagnosis,
           fill = type_of_breast_surgery)) +
  geom_boxplot(outlier.shape = 16, alpha = 0.3, color="black") +
  stat_summary(fun = mean, geom = "point", shape = 16, size = 2, color = "blue") +
  geom_jitter(color= "#ADD8E6",width = 0.3, alpha = 0.4, size = 1) +
  scale_fill_manual(values = c("#4DBBD5", "pink")) +
  labs(
    x = "Tipo de cirugia",
    y = "Edad de diagnóstico",
    title = "Tipo de cirugia en función a la edad del diagnóstico"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "right") +
  annotate("text",
           x = 1.5,
           y = max(datos_filtrados_1$age_at_diagnosis, na.rm = TRUE) * 1.05,
           label = "*** p = 3.488e-08",
           size = 5)
````

Las mujeres que no tuvieron que realizarse la mastectomía presentaron una edad de diagnóstico menor que aquellas que tuvieron que realizarse la cirugía presentando una edad de diagnóstico más elevada. 



Ahora vamos a analizar las medias realizando el **T-test**. Nuestra variable numérica será la edad y la variable categórica es el tipo de cirugía.
Primero extraemos las columnas *age_at_diagnostic* y *type_of_breast_surgery* como vectores

```{r columnas como vectores 1, echo=FALSE}
edad <- datos_filtrados_1 %>% pull(age_at_diagnosis)
cirugia <- datos_filtrados_1 %>% pull(type_of_breast_surgery)
t_test_result <- t.test(edad ~ cirugia)
t_test_result


```

Como el p valor sale 3.488 × 10<sup>-8</sup> , menor a 0,05 , existen **diferencias significativas** entre la edad de diagnóstico y el tipo de cirugía realizada.

## Análisis de tamaño del tumor y tipo de cirugía 


```{r seleccion_de_columnas_2, echo=FALSE}
datos_filtrados_2 <- mis_datos %>%
  filter(!is.na(type_of_breast_surgery),
         type_of_breast_surgery != "")%>% 
  select(3, 29)

```


```{r tabla estadistica descriptivas tamaño del tumor y cirugía, echo=FALSE}
Resumen_Tabla_2 <- datos_filtrados_2 %>%
  summarise(n = length(tumor_size),
    Media = mean(tumor_size, na.rm = TRUE),
    Mediana = median(tumor_size, na.rm = TRUE),
    SD = sd(tumor_size, na.rm = TRUE),
    Mínimo = min(tumor_size, na.rm = TRUE),
    Máximo= max(tumor_size, na.rm = TRUE)) 
kable(Resumen_Tabla_2, 
      caption = "Tabla 2. Estadísticas descriptivas del tamaño del tumor")
print(Resumen_Tabla_2)
```

Ahora vamos a analizar las medias realizando el **T-test**. Nuestra variable numérica será el tamaño del tumor y la variable categórica es el tipo de cirugía
Primero extraemos las columnas *age_at_diagnostic* y *type_of_breast_surgery* como vectores

```{r columnas como vecotres 2, echo=FALSE}
tamaño_tumor <- datos_filtrados_2 %>% pull(tumor_size)
cirugia <- datos_filtrados_2 %>% pull(type_of_breast_surgery)
t_test_result <- t.test(tamaño_tumor ~ cirugia)
t_test_result

```



### Gráficos de resultados de tipo de tumor y tipo de cirugía


````{r grafico tamaño del tumor y tipo de cirugía,fig.cap = "Figura 2. Boxplot de tipo de cirugía según el tamaño del tumor", echo=FALSE}
ggplot(datos_filtrados_2,
       aes(x = type_of_breast_surgery,
           y = tumor_size,
           fill = type_of_breast_surgery)) +
  geom_boxplot(outlier.shape = 16, alpha = 0.3, color="black") +
  stat_summary(fun = mean, geom = "point", shape = 16, size = 2, color = "blue") +
  #geom_jitter(color= "#ADD8E6",width = 0.2, alpha = 0.4, size = 1) +
  scale_fill_manual(values = c("#4DBBD5", "pink")) +
  labs(
    x = "Tipo de cirugía",
    y = "Tamaño del tumor",
    title = "Tipo de cirugía en función al tamaño del tumor"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "right") +
  annotate("text",
           x = 1.5,
           y = max(datos_filtrados_2$tumor_size, na.rm = TRUE) * 1.05,
           label = "*** p = 2.2e-16",
           size = 5)
````

## Análisis de quimioterapia y Supervivencia en meses  

```{r seleccion_de_columnas_3, echo=FALSE}
datos_filtrados_3 <- mis_datos %>%
  # Convertimos 0/1 de quimioterapia a etiquetas usando ifelse
  mutate(chemotherapy = ifelse(chemotherapy == 0, "No quimioterapia", "Quimioterapia")) %>%
  # Convertimos a factor para que ggplot lo interprete correctamente
  mutate(chemotherapy = factor(chemotherapy, levels = c("No quimioterapia", "Quimioterapia"))) %>%
  # Seleccionamos solo las columnas que nos interesan
  select(7,24) %>%
  # Filtramos filas con valores NA
  filter(!is.na(chemotherapy), !is.na(overall_survival_months))
```



```{r tabla estadistica descriptivas quimioterapia y meses de supervivencia, echo=FALSE}
Resumen_Tabla_3 <- datos_filtrados_3 %>%
  summarise(n = length(overall_survival_months),
    Media = mean(overall_survival_months, na.rm = TRUE),
    Mediana = median(overall_survival_months, na.rm = TRUE),
    SD = sd(overall_survival_months, na.rm = TRUE),
    Mínimo = min(overall_survival_months, na.rm = TRUE),
    Máximo= max(overall_survival_months, na.rm = TRUE)) 
kable(Resumen_Tabla_3, 
      caption = "Tabla 3. Estadísticas descriptivas de los meses de supervivencia")
print(Resumen_Tabla_3)
```




```{r columnas como vecotres 3, echo=FALSE}
quimioterapia <- datos_filtrados_3 %>% pull(chemotherapy)
Meses_de_Supervivencia <- datos_filtrados_3 %>% pull(overall_survival_months)
t_test_result <- t.test(Meses_de_Supervivencia ~ quimioterapia)
t_test_result

```

### Gráficos de resultados de meses de supervivencia y tratamiento con quimioterapia

````{r grafico quimioterapia y meses supervivencia,fig.cap = "Figura 3. Boxplot de los meses de supervivencia según si los pacientes recibieron tratamiento con quimioterapia o no", echo=FALSE}
ggplot(datos_filtrados_3,
       aes(x = chemotherapy,
           y = overall_survival_months,
           fill = chemotherapy)) +
  geom_boxplot(outlier.shape = 16, alpha = 0.3, color="black") +
  stat_summary(fun = mean, geom = "point", shape = 16, size = 2, color = "blue") +
  geom_jitter(color= "#ADD8E6",width = 0.4, alpha = 0.4, size = 1) +
  scale_fill_manual(values = c("#4DBBD5", "pink")) +
  labs(
    x = "Administración de quimioterapia",
    y = "Meses de supervivencia",
    title = "Supervivencia según tratamiento con quimioterapia"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "right") +
  annotate("text",
           x = 1.5,
           y = max(datos_filtrados_3$overall_survival_months, na.rm = TRUE) * 1.05,
           label = "***  p = 1.39e-12",
           size = 5)

````



# Discusión

## Análisis de edad de diagnostico vs tipo de cirugía

Tras analizar estadísticamente las variables edad de diagnóstico y tipo de cirugía, los resultados muestran una edad media de diagnóstico de 61,14 años. La mediana es de 61,82 años, lo que indica que existe una distribución equilibrada o simétrica, ya que no se observa una tendencia marcada hacia edades mas jóvenes o más avanzadas.

Esto refleja que aunque el diagnóstico de cáncer de mama es más frecuente en mujeres de mediana y mayor edad, también existen casos más precoces. Según lo descrito en diversos estudios científicos, la incidencia es mayor a partir de los 50 años.  
La edad media mínima de diagnóstico es de 21,93 años, mientras que la edad máxima es de 96,29 años.
La desviación estándar es de 12,97, esto indica que la edad de diganóstico en mujeres varía entre las pacientes por lo que el cáncer de mama afecta en distintas etapas de la vida. La mayoría de los casos de diagnóstico se encuentran entre las edades de 48 y 74 años. 

En el gráfico se observa como los diagnósticos se concentran alrededor de edades similares. Las mujeres que se sometieron a una mastectomía fueron diagnosticadas en edades más avanzadas que aquellas que conservaron el pecho. Sin embargo, al ser las edades de diagnóstico entre ambos grupos de mujeres muy similares, la edad no determina por si sola el tipo de cirugía. Por otro lado, el punto negro representa la media, siendo el de las mujeres que conservaron el pecho de 59.17 años, y las que se realizaron una mastectomía de 62.46 .Estos valores se encuentran cercanos a la mediana, lo que sugiere que la distribución es equilibrada y no hay valores extremos (*outliers*).

Por último, en el T-test se obtiene un valor de p=3.488 x 10 <sup>-8</sup>. Este dato es menor a 0,05, por lo que, **se rechaza la hipótesis nula y se acepta la alternativa**. Es decir, **existen diferencias significativas entre las edades correspondientes de las mujeres que se sometieron a mastectomía, en comparación con las que conservaron el pecho**.


## Análisis del tamaño de tumor vs tipo de cirugía

Tras analizar estadísticamente las variables tamaño del tumor y tipo de cirugía, los resultados muestran un tamaño medio de tumor de 26,16 mm. La mediana es de 23 mm, lo que indica que existe una distribución equilibrada o simétrica, ya que no se observa mucha variabilidad entre el tamaño de los tumores. 

La desviación estándar es de 15,03, esto indica que el tamaño del tumor varía considerablemente entre las pacientes. La mayoría de los casos de diagnóstico se encuentran entre las edades de 11 y 41 años. El valor mínimo de tamaño del tumor es de 1 mm, mientras que el tamaño máximo es de 182 mm.

En el T-test se obtiene un valor de p=2,2 x 10 <sup>-16</sup>. Este dato es menor a 0,05 lo que refleja que existen diferencias significativas entre el tamaño de los tumores y el tipo de cirugia realizada. Por lo tanto, **se rechaza la hipótesis nula y se acepta la hipótesis alternativa**: "**El tamaño medio del tumor de las mujeres con mastectomia es mayor al tamaño medio de las que conservaron el pecho**".

En el gráfico se observa como las pacientes que conservan el pecho tienen tumores de menor tamaño que aquellas que se sometieron a mastectomía. La mediana en las pacientes que conservan el pecho es más baja indicando el menor tamaño de los tumores en este grupo.Sin embargo, en el grupo de mastectomía el tamaño es mayor. Además, en este último grupo se observan muchos valores atípicos (*outliers*) hacia tamaños grandes, lo que indica que cuando el tumor es muy grande se trata llevando a cabo una mastectomía. Por ende, hay una mayor probabilidad de someterse a una mastectomía en presencia de mayores tamaños de tumor.


## Análisis de quimioterapia vs meses de supervivencia.

Tras analizar estadísticamente las variables quimioterapia y meses de supervivencia, los resultados muestran un valor medio de meses de supervivencia de 125,12. La mediana es de 115,61 meses, lo que indica que existe una distribución no simétrica sesgada a la derecha. Esto se debe a que la media es mayor a la mediana.

La desviación estándar es de 76,33, esto indica que existe una dispersión bastante grande de los datos. La mayor parte de los valores se encuentran entre 48 y 201 meses de supervivencia. El valor mínimo de meses de supervivencia tras el diagnóstico es de 0 meses, mientras que el valor máximo es de 355,2 meses. 

En el T-test se obtiene un valor de p=1,39 x 10 <sup>-12</sup>. Este dato es menor a 0,05 lo que refleja que existen diferencias significativas entre la administración o no de quimioterapia y los meses de supervivencia tras el diagnóstico. Por lo tanto, **se rechaza la hipótesis nula y se acepta la hipótesis alternativa**: " **Los meses de supervivencia están relacionados significativamente con la administración de quimioterapia**". 

En el gráfico se observa como las pacientes que se han sometido a quimioterapia sobreviven menos meses que aquellas que no se han sometido a quimioterapia. Esto se debe a que aquellas mujeres que recibieron quimioterapia estaban en etapas más avanzadas de la enfermedad. La mediana en las pacientes con tratamiento de quimioterapia es más baja si comparamos con las que no se han sometido a quimioterapia, en las que la mediana de supervivencia es claramante mayor. En la representación de la cohorte de las mujeres tratadas con quimioterapia se observa un outlier, es decir, un valor muy alejado del resto que no se integra en la representación. 


# Conclusiones

Los resultados obtenidos a partir de los análisis estadísticos, nos indican que el tipo de cirugía está relacionado principalmente con el tamaño del tumor, y en menor medida con la edad de diagnóstico. Por consiguiente, la supervivencia se asocia con la administración de quimioterapia, en donde aquellas pacientes que recibieron el tratamiento mostraron menor superviviencia debido a que posiblemente recurrieron a quimioterapia por encontrarse en un estado más avanzado del cáncer.

---

# Referencias
Se han utilizado los datos de METABRIC [@raghadalharbi_2020]

